<html><head>
<!-- TODO: 

TORRENT FILE IN SAME PAGE
TAKE OVER ACADEMIC RESEARCH

when you upload you need the most recent infohash

EDITION PART

IF GET gives dupe torrent don't re-add

DB ARCHITECTURE: IMMUTABLE TORRENT FILES STORE ADVANCING DB HELD TOGETHER BY CHAINLINK

acid anger fade immune write aim lab there hard fat swift priority

copyright storing torrent metadata to blockchain

 !-->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/webtorrent@latest/webtorrent.min.js"></script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>

 <script type="text/javascript"  src="https://cdnjs.cloudflare.com/ajax/libs/alchemyjs/0.4.2/scripts/vendor.js"></script>
 <script type="text/javascript"  src="https://cdnjs.cloudflare.com/ajax/libs/alchemyjs/0.4.2/alchemy.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/alchemyjs/0.4.2/alchemy.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/alchemyjs/0.4.2/styles/vendor.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs/dt-1.10.23/kt-2.5.3/r-2.2.7/sb-1.0.1/datatables.min.css"/>
 
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<script type="text/javascript" src="https://cdn.datatables.net/v/bs/dt-1.10.23/kt-2.5.3/r-2.2.7/sb-1.0.1/datatables.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/taffydb@2.7.3/taffy.min.js"></script>

<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Yusei+Magic&display=swap" rel="stylesheet">

<script>
//ferross code
	!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).dragDrop=e()}}(function(){return function(){return function e(t,r,n){function o(a,f){if(!r[a]){if(!t[a]){var u="function"==typeof require&&require;if(!f&&u)return u(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var s=r[a]={exports:{}};t[a][0].call(s.exports,function(e){return o(t[a][1][e]||e)},s,s.exports,e,t,r,n)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}}()({1:[function(e,t,r){var n,o,i=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function f(){throw new Error("clearTimeout has not been defined")}function u(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{o="function"==typeof clearTimeout?clearTimeout:f}catch(e){o=f}}();var l,s=[],c=!1,d=-1;function p(){c&&l&&(c=!1,l.length?s=l.concat(s):d=-1,s.length&&h())}function h(){if(!c){var e=u(p);c=!0;for(var t=s.length;t;){for(l=s,s=[];++d<t;)l&&l[d].run();d=-1,t=s.length}l=null,c=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===f||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];s.push(new m(e,t)),1!==s.length||c||u(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],2:[function(e,t,r){t.exports=function(e,t){if("string"==typeof e){const t=e;if(!(e=window.document.querySelector(e)))throw new Error(`"${t}" does not match any HTML elements`)}if(!e)throw new Error(`"${e}" is not a valid HTML element`);"function"==typeof t&&(t={onDrop:t});let r;return e.addEventListener("dragenter",i,!1),e.addEventListener("dragover",a,!1),e.addEventListener("dragleave",f,!1),e.addEventListener("drop",u,!1),function(){l(),e.removeEventListener("dragenter",i,!1),e.removeEventListener("dragover",a,!1),e.removeEventListener("dragleave",f,!1),e.removeEventListener("drop",u,!1)};function i(e){return t.onDragEnter&&t.onDragEnter(e),e.stopPropagation(),e.preventDefault(),!1}function a(n){if(n.stopPropagation(),n.preventDefault(),t.onDragOver&&t.onDragOver(n),n.dataTransfer.items||n.dataTransfer.types){const e=Array.from(n.dataTransfer.items),r=Array.from(n.dataTransfer.types);let o,i;if(e.length?(o=e.filter(e=>"file"===e.kind),i=e.filter(e=>"string"===e.kind)):r.length&&(o=r.filter(e=>"Files"===e),i=r.filter(e=>e.startsWith("text/"))),0===o.length&&!t.onDropText)return;if(0===i.length&&!t.onDrop)return;if(0===o.length&&0===i.length)return}return e.classList.add("drag"),clearTimeout(r),n.dataTransfer.dropEffect="copy",!1}function f(e){return e.stopPropagation(),e.preventDefault(),t.onDragLeave&&t.onDragLeave(e),clearTimeout(r),r=setTimeout(l,50),!1}function u(e){e.stopPropagation(),e.preventDefault(),t.onDragLeave&&t.onDragLeave(e),clearTimeout(r),l();const i={x:e.clientX,y:e.clientY},a=e.dataTransfer.getData("text");if(a&&t.onDropText&&t.onDropText(a,i),t.onDrop&&e.dataTransfer.items){const r=e.dataTransfer.files,a=Array.from(e.dataTransfer.items).filter(e=>"file"===e.kind);if(0===a.length)return;n(a.map(e=>t=>{!function(e,t){let r=[];if(e.isFile)e.file(r=>{r.fullPath=e.fullPath,r.isFile=!0,r.isDirectory=!1,t(null,r)},e=>{t(e)});else if(e.isDirectory){const i=e.createReader();!function i(a){a.readEntries(f=>{f.length>0?(r=r.concat(Array.from(f)),i(a)):n(r.map(e=>t=>{o(e,t)}),(r,n)=>{r?t(r):(n.push({fullPath:e.fullPath,name:e.name,isFile:!1,isDirectory:!0}),t(null,n))})})}(i)}}(e.webkitGetAsEntry(),t)}),(e,n)=>{if(e)throw e;const o=n.flat(1/0),a=o.filter(e=>e.isFile),f=o.filter(e=>e.isDirectory);t.onDrop(a,i,r,f)})}return!1}function l(){e.classList.remove("drag")}};const n=e("run-parallel");function o(e,t){let r=[];if(e.isFile){e.file(r=>{r.fullPath=e.fullPath;r.isFile=true;r.isDirectory=false;t(null,r)},e=>{t(e)})}else if(e.isDirectory){const t=e.createReader();i(t)}function i(e){e.readEntries(t=>{if(t.length>0){r=r.concat(Array.from(t));i(e)}else{a()}})}function a(){n(r.map(e=>{return t=>{o(e,t)}}),(r,n)=>{if(r){t(r)}else{n.push({fullPath:e.fullPath,name:e.name,isFile:false,isDirectory:true});t(null,n)}})}}},{"run-parallel":3}],3:[function(e,t,r){(function(e){t.exports=function(t,r){var n,o,i,a=!0;Array.isArray(t)?(n=[],o=t.length):(i=Object.keys(t),n={},o=i.length);function f(t){function o(){r&&r(t,n),r=null}a?e.nextTick(o):o()}function u(e,t,r){n[e]=r,(0==--o||t)&&f(t)}o?i?i.forEach(function(e){t[e](function(t,r){u(e,t,r)})}):t.forEach(function(e,t){e(function(e,r){u(t,e,r)})}):f(null);a=!1}}).call(this,e("_process"))},{_process:1}]},{},[2])(2)});</script>
 <script type="text/javascript" type="text/javascript">
 //db
 </script>

	<script type="text/javascript">


	var torrentID; 

	var db_whjat_nodes = TAFFY([
	]);

	var db_swarm_nodes = TAFFY([
	]);

	var db_edges = TAFFY([
	])

	function tabFile(){
		console.log(document.location);
		window.open(document.location.pathname + "#" + torrentID)
	}




		//


		var table;

		//view
		/*function addWhatTR(attr){
			table.row.add([attr.name, attr.author, attr.torrentCreated, attr.size, attr.numPeers, "[1,2,3]"]).draw();

		}*/


		//model
		function attrGet(torrent){
			console.log("Setting attributes from metadata");
			return {
					"name" : torrent.name,
					"magnetURI" : torrent.magnetURI,
					"numPeers" : torrent.numPeers,
					"torrentCreated": torrent.created,
					"author" : torrent.createdBy,
					"size" : torrent.size
				}
		}


	function viewFile(file){
		var div = document.createElement("div");
		file.appendTo(div);
		$(".media").append(div);
		$("#mediaViewer").fadeIn();
	}

	function log (str) {
        var p = document.createElement('p')
        p.innerHTML = str
        document.querySelector('.log').appendChild(p)
      }




 //db API
 //call chainlink
 //chainlink stores latest DB

 
 function uploadFile(){

 }

 var params;

//TODO code rollback


$(document).ready(function(){



/*
	SET THE VIEW
*/
	
	var sidebar = true;
	$(".hamburger").click(function(){
		$(".sidebar").toggle("slide");
	})




	$("#alchemy").hide();
	$(".tile").show();

	$(".browse").hide();
	$(".sidebar").hide();
	$(".main").width("100%");

	/*$('.sidebar').hover(function() {
	    $(this).fadeTo(1,1);
	    $(".main").width("78%");
	},function() {
	    $(this).fadeTo(1,0);
	    $(".main").width("100%");
	});*/

//Genius idea
//use TORRENT SEEDING TIME as proof of stake 
//now the What castes are immanent in the browser
//you simply allow money transfer on top of this

//initialize

var client = new WebTorrent();

//DOWNLOAD ENTIRE Library
//todo:


//im not gonna make a new torrent file every time you wanna download the library

	/*
		Handle retrieval
	*/

	setInterval(function(){
		seedRecentInfoHash();
	}, 900)

	seedRecentInfoHash();
	function seedRecentInfoHash(){
	
	$.ajax({
        url: "https://jsonblob.com/api/jsonBlob/7947cb51-5bad-11eb-8917-6dadd9cd50ea",
        type: 'GET',
        success: function(res) {
        	
        	if(lastHash !== res.infoHash){
        		lastHash = res.infoHash;
	            var torrent = client.add(hashToMagnet(res.infoHash));
	            torrent.on("metadata", function(){
					//throttle torrent or deslect file 
				//	torrent.files.forEach(function(file){
						//file.deselect();
						torrent.files.forEach(function (file, index, arr) 
					    {
					        file.deselect();
					    });
						torrent.deselect(0, torrent.pieces.length - 1, false);
				//	});
				
					updateDB(torrent);
				})


        	}
        	
        }
	});	
	}



	
	// Send messages
	//conn.send('Hello!');

//view controls

//	$(".upload").hide();

	$("#table").click(function(e){
		//e.preventDefault();
		console.log("table click")	
		$(".alchemy").hide();
		$(".tile").hide();
		$(".log").hide();
		$(".browse").show();

	})


	$("#graph").click(function(e){
		console.log("here 2")
		$(".browse").hide();
		$("#alchemy").show();
		$(".log").hide();
		$(".tile").hide();
	})

	$("#tile").click(function(e){
		console.log("here 3")
		$(".browse").hide();
		$(".alchemy").hide();
		$(".tile").show();
		$(".log").hide();

	})

	$("#log").click(function(e){
		$(".browse").hide();
		$("#alchemy").hide();
		$(".tile").hide();
		$(".log").show();
	})
	
	var alchemy;

	var i = 0;
	var j = 0;

	var tileRow;
	function populateTable(node){
		if(!node) return;

			var ext = node.ext;
			console.log(ext)
			var str = "<a target='_blank' href='#" + node.infoHash + "'>." + ext + "</a>";

			//make download

			//populate tile
			var tileSquare = document.createElement("div");
			$(tileSquare).addClass("tileSquare")
			var img = document.createElement("img");
			$(img).width("81");
			$(img).height("132");
			infoHashStr = "'" + node.infoHash + "'";

			console.log(ext);
		










			//gr8 hacking
			



						$('.tile').prepend("<div class='tileSquare'><img id='tileIMG' class='img-responsive'><a target='_blank' class='nodeClick' href='#" + node.infoHash + "'><span>" + node.author + " - "  + node.title + "</span></a><a href='" + hashToMagnet(node.infoHash) + "'>[magnet]</a>")


			//switch(ext){
			//	case "pdf": 
					$("#tileIMG").attr("src", "https://upload.wikimedia.org/wikipedia/commons/8/87/PDF_file_icon.svg");
			//		break;
			//	case "mp3": 
			//		$("#tileIMG").attr('src', "https://image.flaticon.com/icons/png/512/81/81281.png");
			//		break;
			//	default :
			//		$("#tileIMG").attr("src", "https://upload.wikimedia.org/wikipedia/commons/8/87/PDF_file_icon.svg");
			//}


			//populate table
			table.row.add([node.author + ".", node.date + ".", node.title + ".", node.publisher + ".", node.numPeers, str]).draw();


			/*ATHENA */
	  	$(".dataTable").on("click", "nodeClick", function(){
				var a = $(this).attr("href");
				console.log(a);

		client.torrents.forEach(function(torrent){

			if(torrent.infoHash === a.substring(1)){
				torrent.select(0, torrent.pieces.length - 1, false);
				torrent.files.forEach(function(file){
					file.select();
				})			
				onTorrent(torrent);
			}
		})

	})

			//brilliant recursion

	
			var magnetURI = hashToMagnet(node.lastHash);

			var torrent = client.add(magnetURI);

			torrent.on('metadata', function(){
				console.log(torrent);
				//torrent.pause();
				torrent.files.forEach(function(file){
					file.deselect();
				});
				updateDB(torrent);
			})
			j++;
			i++;
		
		//}

	}



var config;

	function hashToMagnet(hash){
		return "magnet:?xt=urn:btih:" +  hash  + "&dn=db.json&tr=udp%3A%2F%2Ftracker.leechers-paradise.org%3A6969&tr=udp%3A%2F%2Ftracker.coppersurfer.tk%3A6969&tr=udp%3A%2F%2Ftracker.opentrackr.org%3A1337&tr=udp%3A%2F%2Fexplodie.org%3A6969&tr=udp%3A%2F%2Ftracker.empire-js.us%3A1337&tr=wss%3A%2F%2Ftracker.btorrent.xyz&tr=wss%3A%2F%2Ftracker.openwebtorrent.com"; // from chainlink db	
	}

	//deprecated
	function getDB(){
	 	//query chainlink
	 	var infoHash = lastHash;
	 	//CHAINLINK ADDRESS GOES HERE

	 	//chainlink gives infoHash

	 	//store magnetURIvar infohash = ""; //json torrent infohash
		var client = new WebTorrent()
		var magnetURI = hashToMagnet(infoHash);
		client.add(magnetURI, function (torrent) { 

		  torrent.files.forEach(function (file) { 
		  	if(file.name.endsWith('.json')){			  		
			    file.getBuffer(function (err, buffer) {
				if (err) throw err
				var jsonstring = decodeUtf8(buffer);
				db = JSON.parse(jsonstring);
				

				//f(document.location.hash === "" || document.location.hash === "#"){
	
				

					populateTable(torrent);
					//$("#alchemy").show()
					//alchemy = new Alchemy(config);
				//}
				console.log(db); //json data
							  
				client.destroy();
			    })
		  	}
		  })
		})

	 }

		function decodeUtf8(s) {
		  return decodeURIComponent(escape(s));
		}

	 //master anyone can run their own chainlink node and that is a db

	 //FOR SLAVES
	 //CHAINLINK CALLS femto.pw/etcc


	 function seedDB(torrent){



	 	var tagArr = $("#uploadTags").val().split(' , ');
	 	

	 	

	 	var format = {
	 		"id" : Date.now(),
	 		"title" : $("#uploadTitle").val(),
	 		"author" : $("#uploadAuthor").val(),
	 		"date" : $("#uploadDate").val(),
	 		"tags" : tagArr,
	 		"magnetURI" : torrent.magnetURI
	 	}

	 	db.nodes.push(format);
	 	populateTable();
	 	alchemy = new Alchemy(config);
	 	console.log(alchemy);
	 	var json_source_url = db; //json data source
		var filename = "db.json"; //filename.json

		//$.getJSON(json_source_url, function( data ) {

		  var jsonstring = JSON.stringify(db);
		  var blob = new Blob([jsonstring], {type: "application/json"});
		  var client = new WebTorrent()
		  
		  client.seed(blob, {name: filename}, function(torrent){
		  	console.log(torrent.magnetURI);
		  })   
		  
		  console.log("seeding");
		  
	//	});

	 }


	 /*function queryLINK(torrent){

		var privateKey = new bitcore.PrivateKey('L1uyy5qTuGrVXrmrsvHWHgVzW9kKdrp27wBC7Vs6nZDTF2BRUVwy');
		var utxo = {
		  "txId" : "115e8f72f39fad874cfab0deed11a80f24f967a84079fb56ddf53ea02e308986",
		  "outputIndex" : 0,
		  "address" : "17XBj6iFEsf8kzDMGQk5ghZipxX49VXuaV",
		  "script" : "76a91447862fe165e6121af80d5dde1ecb478ed170565b88ac",
		  "satoshis" : 50000
		};

		var transaction = new bitcore.Transaction()
	    .from(utxo)
	    .addData(torrent.infoHash) // Add OP_RETURN data
	    .sign(privateKey);
	 }*/


	//getDB();
	var lastHash = "70169f26bab340d30730d350ae1e78db9aacc578";
	/*var torrent = client.add("magnet:?xt=urn:btih:db7dabf399d05396684b928a3de2c196a21d5ef7&tr=wss%3A%2F%2Ftracker.btorrent.xyz&tr=wss%3A%2F%2Ftracker.openwebtorrent.com&tr=udp%3A%2F%2Ftracker.leechers-paradise.org%3A6969&tr=udp%3A%2F%2Ftracker.coppersurfer.tk%3A6969&tr=udp%3A%2F%2Ftracker.opentrackr.org%3A1337&tr=udp%3A%2F%2Fexplodie.org%3A6969&tr=udp%3A%2F%2Ftracker.empire-js.us%3A1337");*/
	

	console.log(lastHash);

	params = document.location;


	dragDrop('body', function (files) {
	  client.seed(files, function (torrent) {
	    console.log('Client is seeding ' + torrent.magnetURI)
	    setDB(torrent.magnetURI);
	  })
	})

	var div = $(".column div");
	var width = div.width();
	div.css('height', width*1.297);
	//$(".log").hide();

/*	for (var i = 0; i < db.nodes.length; i++ ){

		var tile = document.createElement("div");

		var span = document.createElement("span");
		$(span).addClass("tileSpan");
		//next thing you know they'll take my thots away
		$(tile).addClass("tile")
		$(tile).append(span)
		$(".tiles").append(tile)

	}
*/
	torrentID = document.location.hash.substring(1);
	client.on('error', function (err) {
        console.error('ERROR: ' + err.message)
      })

      
	//getDB();
      //document.querySelector('form').addEventListener('submit', function (e) {
       // e.preventDefault() // Prevent page refresh
		// client.add(torrentID, onTorrent);

     // })

	function implementDB(torrent){
		console.log(torrent.files);
		torrent.on('done', function(){
			db = torrent.files.find(function (file) {
   				return file.name.endsWith('.json')
   			//	console.log(db);
   				//populateTable();
  			})


		})
	}   



      function onTorrent (torrent) {
        log('Got torrent metadata!')
        log(
          'Torrent info hash: ' + torrent.infoHash + ' ' +
          '<a href="' + torrent.magnetURI + '" target="_blank">[Magnet URI]</a> ' +
          '<a href="' + torrent.torrentFileBlobURL + '" target="_blank" download="' + torrent.name + '.torrent">[Download .torrent]</a>'
        )

        // Print out progress every 5 seconds
        var interval = setInterval(function () {
          log('Progress: ' + (torrent.progress * 100).toFixed(1) + '%')
        }, 5000)

        torrent.on('done', function () {
          log('Progress: 100%')
          clearInterval(interval)
        })

        // Render all files into to the page
        torrent.files.forEach(function (file) {
          file.appendTo('.log')
          log('(Blob URLs only work if the file is loaded from a server. "http//localhost" works. "file://" does not.)')
          file.getBlobURL(function (err, url) {
            if (err) return log(err.message)
            log('File done.')
            log('<a href="' + url + '">Download full file: ' + file.name + '</a>')
          })
   		})
    }

  //  ATHENA
	if(torrentID !== "" && torrentID !== "#") {
		console.log(torrentID);
		$("#alchemy").hide();
		$(".log").show();
		$(".tile").hide();
		$(".browse").hide();

        log('Adding ' + torrentID)
	     client.add(hashToMagnet(torrentID), onTorrent);

	}
	table = $("table").DataTable({
		responsive:true,
		columnDefs : [
		{
			targets: 0,
			width:"25%"
		},
		{
			targets:1,
			width:"20%"
		}],
		rowReorder: true,
        scrollY: "60%",
        height: "85%",
        paging: false,
        "drawCallback" :  function(){
      	}
			
	});

	$('#dataTable').on( 'draw.dt', function () {
		  	$(".nodeClicked").click(function(){
				var a = $(this).attr("href");
				console.log(a);

		client.torrents.forEach(function(torrent){

			if(torrent.infoHash === a.substring(1)){
				torrent.select(0, torrent.pieces.length - 1, false);
				torrent.files.forEach(function(file){
					file.select();
				})			
				onTorrent(torrent);
			}
		})

	})
	})


	//$(".table").hide();

	$.fn.dataTable.ext.errMode = 'none';

		/*$("#file").click(function(){
		$("#alchemy").hide()
		$(".table").hide();
		$("#mediaViewer").show();
	})*/



/*	

	table.row.add(["Thus Spoke Zarathustra", "Friedrich Nietzsche", 1886, "5mb", "philosophy, ethics", "", str]);
	table.row.add(["The Phenomenology of Perception", "Maurice Merleau-Ponty"])
	table.row.add(["Madness and Civilization", "Michel Foucault"])
	table.row.add(["Being and Time", "Martin Heidegger"])
	table.row.add(["The Phenomenology of Spirit", "George Wilhelm Friedrich Hegel"])
	table.row.add(["What Computers Can't Do", "Hubert Dreyfus"]).draw();*/

	

	$.fn.dataTable.ext.errMode = 'none';


		$("form").submit(function(e){
			e.preventDefault();
		})


		//parse URI
		//torrentID = document.location.hash.substring(1);
		//downloadTorrent();
		window.onhashchange = function(){
    		torrentID = hashToMagnet(document.location.hash.substring(1));
   			//$("#text").val(magnetURI);
   			//torrentID = magnetURI;
        }

		//upload files, generate URI


	/*
		uploadToAPA : Parses upload text data
		Return str APA style
	*/
	function uploadToAPA(){
		var commentStr = '{"id" : ' + Date.now() + ', "title" :  "'+  + '", "lastHash" : "'+ lastHash +'"}'
		//var tagArr = $("#uploadTags").val().split(' , ');

		console.log($("#uploadAuthor").val());
		return $('#uploadAuthor').val().split('.').join("") + " - (" + $('#uploadDate').val().split('.').join("") + ") - " + $("#uploadTitle").val().split('.').join("") + " - " + $("#uploadPublisher").val().split('.').join("") + " - " + lastHash + ".pdf"
		
	}

	//the hash mary

	/*
		Takes APA format filename and fills upload text boxes
	*/
	
	$("#file").change(function(){
		var file = APAtoObj($(this).val());

		$("#uploadTitle").val(file.title);
		$("#uploadAuthor").val(file.author.replace(/^.*[\\\/]/, ''));
		$("#uploadDate").val(file.date.slice(1,-1));
		$("#uploadPublisher").val(file.publisher);
	})



	//ATHENA PATENT PENDING
	var jsonBlobAddy = "7947cb51-5bad-11eb-8917-6dadd9cd50ea";


	$("#uploadButton").click(function(){
	
 		/* 
			Seeds the files and names torrent file to APA style		
		*/
		client.seed($("#file")[0].files, {"name" : uploadToAPA()}, function(torrent){
			blobAddy = $("#blob").val() ? $("#blob").val() : blobAddy;
	$.ajax({
        url: "https://jsonblob.com/api/jsonBlob/" + blobAddy,
        type: 'PUT',
        contentType : 'application/JSON',
        data : '{"infoHash" : "' + torrent.infoHash + '"}',
        // added data type
        success: function(res) {
            updateDB(torrent);
            //client.add(hashToMagnet(res.infoHash));
        }
    });
    //ATHE5 STAMP / btc
    //operation tramp stamp

			
		});
			
	});

		//todo: spider to find DOI from filename on upload drag and drop

		var node;

	/*
		160 char torrents as comments 
		use the file name as a comment!
	*/


	/*
		Parses APA formatted torrent name	
	*/
	function APAtoObj(name){

		//var author = name.substr(0, name.indexOf('. ('));

		//clear periods first

		console.log(name);
		var data = name.split(" - ");

		var author;
		var data;
		var publisher;
		var title;
		var lastHashData;

		author = data[0];
		title = data[2];
		date = data[1];
		publisher = data[3];
		lastHashData = data[4];

/*
		name = name.substr(name.indexOf(".")) 

		var regExp = /\(([^)]+)\)/;
		var matches = regExp.exec(name);

		if(matches !== null){
			var date = matches[1];	
		}

		var publisher = /[^.]*$/.exec(name)[0];

		//Dane, J. J. (2009). Cook. Amazon.
		


		//console.log(name.length - publisher.length);

		//todo: merge*/
		return {
				"title": title,
				"author" : author,
				"date" : date,
				"publisher" : publisher,
				"lastHash" : lastHashData
		}

	}

	//taffydb



	function updateDB(torrent){
		//lastHash = torrent.infoHash;


		console.log(torrent.name);
		//passes torrent name (APA style) to APAtoObj to parse
		var whjat = APAtoObj(torrent.name);


				
		//point to infoHash of last uploaded torrent
		whjat.id = Date.now();
	//	whjat.lastHash = lastHash;
		whjat.infoHash = torrent.infoHash;
		whjat.numPeers = torrent.numPeers;

		//records torrent address of this node as the last hash
		lastHash = whjat.infoHash;

		whjat.ext = torrent.name.split('.').pop();

		db_whjat_nodes.insert(whjat);


		torrent.swarm.wires.forEach(function (wire) {
			console.log(wire);
			peer = {
				"id" : wire.peerId,
				"title" : wire.peerId,
				"metadata" : {
					remoteAddress : "",
					tripfag : ""

				}
			}
		    db_swarm_nodes.insert(peer)
		
		    db_edges.insert({
				"target" : whjat.id,
				"source" : peer.id
			})

		})

		var nodes = db_whjat_nodes().get().concat(db_swarm_nodes().get());

		var edges = db_edges().get(); //ath

		var dataSource = {
			"nodes" : nodes,
			"edges" : edges
		}


		populateTable(whjat);



		//add node to alchemy
		console.log(db_whjat_nodes().get());
		var	config = { 
						dataSource : dataSource,
						cluster: true, 
				        clusterColours: ["#DD79FF", "#00FF30", "#5168FF", "#f83f00", "#ff8d8f"],
				        forceLocked: false,
				        nodeCaption: "title", 
				        edgeCaption: "relatedness",
				        nodeCaptionsOnByDefault: true,
				        nodeTypes: {"type":["philosophy, esoteric"]},
				        directedEdges:true,
				        nodeStyle: {
				            "philosopher": {
				                "radius": 18
				            }
				        },
				        initialScale: 0.7, 
				        initialTranslate: [250,150],
						"graphWidth" : function() {
							return $(window).width();
						},
						"graphHeight" : function(){
							return $(window).height();
						},
						nodeClick : function(node){
							console.log(node);
							torrentID = node._properties.infoHash;
							//tabFile();

							//find this torrent and select it
							client.torrents.forEach(function(torrent){
								if(torrent.infoHash === torrentID){
									torrent.select(0, torrent.pieces.length - 1, false);

									torrent.files.forEach(function(file){
										file.select();
									})	
									onTorrent(torrent);								
								}
							})
						//	client.add(hashToMagnet(torrentID), onTorrent);
							//downloadTorrent(magnetURI);
						}
						/*,
						showControlDash: true,
						search:true,
						showStats: true,
						nodeStats: true,

						showFilters: true,
						nodeFilters: true,

						captionToggle: true,
						edgesToggle: true,
						nodesToggle: true,
						toggleRootNotes: false,

						zoomControls: true*/

					}

		alchemy = new Alchemy(config);
//		$("#alchemy").show();
		client.add(hashToMagnet(whjat.lastHash), updateDB);
	}







	/*	$("input").val("magnet:?xt=urn:btih:f215822fd76359d0998244cae2e1cf608cedca4e&dn=New+folder&tr=udp%3A%2F%2Ftracker.leechers-paradise.org%3A6969&tr=udp%3A%2F%2Ftracker.coppersurfer.tk%3A6969&tr=udp%3A%2F%2Ftracker.opentrackr.org%3A1337&tr=udp%3A%2F%2Fexplodie.org%3A6969&tr=udp%3A%2F%2Ftracker.empire-js.us%3A1337&tr=wss%3A%2F%2Ftracker.btorrent.xyz&tr=wss%3A%2F%2Ftracker.openwebtorrent.com")*/
	
	
		//model
		


		function dlFile(){

		}

		

			

})



</script>
 </head>
 <body>
	 <!--!-->
		<a href="#" class="hamburger"> &#9776; </a><h1 id="title">torrentmail.us</h1>		
	 		
	 	<div class="sidebar">
			
	 	<!--	<div class="page-header">
				<h2>My Settings</h2>
			</div>!-->

			<br><br><br>
			<div id="settingsPageHeader" class="page-header">
				<!--ATHENA!-->
					<h3>My Panel</h3>
				</div>		
		<div class="upload">					
			<input type="file" id="file" multiple name="files" class="form-control" id="customFile" />				
			<input class="form-control" id="uploadAuthor" type="text" placeholder="last name, initials">
			<input class="form-control" id="uploadTitle" type="text" placeholder="title">
			<input class="form-control" id="uploadPublisher" type="text" placeholder="publisher">
			<input class="form-control" type="text" id="uploadDate" placeholder="date">
			<p>Send to Address:</p>
			<input class="form-control" type="text" id="blobAddy" placeholder = "7947cb51-5bad-11eb-8917-6dadd9cd50ea">
			<button id = "uploadButton" class="btn">Send</button>
		</div>
		<div id="nav">
			<button class="btn" id="tile"><a href="#">Tile</a></button>
			<button class="btn" id="table"><a href="#">Table</a></button>
			<button class="btn" id="graph"><a href="#">Graph</a></button>
		<!--	<button class="btn" id="log"><a href="#">My DLs</a></button> !-->
		</div>
		</div>
		
			
		<div class="main">
			<div class="page-header">
				<h3>My Letters</h3>
			</div>
			<div class="tile">

			</div>
			<div class="browse">
			

			<div class="table">
			
				<table id="DataTables_Table_0" class="dataTable">
					<thead>
						<tr>
							<th>Author</th><th>Date</th><th>Title</th><th>Publisher</th><th>Peers</th><th class="none">Editions</th>
						</tr>
					</thead>
				</table>
			</div>
			
			</div>
			<div class="alchemyContainer">
				<!--<div class="page-header">
					<h3>Torrent Web</h3>
				</div>!-->
				<div class="alchemy" id = "alchemy">			
				</div>
			</div>

			<div class="log"><br><br><br></div>
				
		</div>

	<!--<div class="toggleCtrls"><div><span><a href="#" id="list" href="#">List</a></span><span>/</span><span><a href="#" id="graph" href="#">Graph</a></span></div><span>/</span><span><a href="#">Torrents</a></span></div>!-->
	

</body>

<!--<footer><span>Upload</span>&nbsp;<input type="file" name="files[]" id="file" multiple>
	 <br>
	<input id="text" placeholder="magnetURI" type="text"><button onclick="downloadTorrent()">Download</button></footer>!-->
	
	<style>
		body{
			background-color:white;
			color:black;
			font-family:Arial;
			overflow:hidden;
			background-color:#ffff80;
		}

		a{
			color:blue;
		}

		a:hover{
			color:yellow;
		}

		td, object{
			padding:17px;
		}

		span{
			float:left;
		}

		.hamburger{
			position:fixed;
			z-index:6;
			font-size:55px;
			color:orange;
			
		}

		h1{
			margin:13px 0px 0px 55px;
			
			font-variant:small-caps;
			font-family:"Yusei Magic", "Arial";
			position:fixed;
			font-size:45px;
			float:left;
			z-index:9999;
			color:#66d9ff;

			width:20%;
			height:75px;


		}

		#logo{
			width:42px;
			height:40px;
			left:0px;
			float:left;
			position:relative;
			top:24px;
			z-index:9009;


		}

		

		.upload{
			position:fixed;
			
			padding-top:55px;
		}
		.upload input{
			width:inherit;
		}

		.table{
			position:relative;
			z-index:3;
		}

		#nav{
			position:fixed;
			text-align:center;
			width:30%;
			bottom:0px;
		}


		.main{
			width:78%;
			float:right;
			overflow-x:hidden;
			z-index:3;
			overflow-y:scroll;
			height:100%;
			/*margin-left:2%;*/
			position:absolute;
			

		}


		.alchemyContainer{
		}


		.log{
		 	height:100%;
		 	width:100%;	
		}


		
	

		#alchemy{
		 	bottom:0;
		 	right:0;
			display:none;
			position:absolute;
			z-index:4;
			margin:0 auto;
			height:100%;

		}

/*ATHENA*/
		.page-header h2{
			color:#ffff80;
			z-index:99;
			font-family:"Roboto",Georgia;
			position:absolute;
		}

		.page-header h3{
			padding:25px;
/*ATHENA*/
			color:#333300;
			font-size:17px;
		
			
			position:fixed;
			z-index:9999;

		}

		/* ATHENA */ 
		#settingsPageHeader h3{
			background-color:white;
		}

		.off-canvas div{
			display:none;
		}

/*		element{
			width:34%;
		}*/

		.sidebar{
			width:31%;
			display:none;
			z-index:4;
			border-right:2px solid #CDcDcD;
			position:fixed;
			background-color:white;
			float:left;
			height:100%;
		}

		.mediaWidget{
			height:93%;
			width:100%;
			float:right;
			z-index:9999;
		}

		#mediaViewer{
			width:100%;
			height:93%;
			position:fixed;
			color:gray;
		}


		.media{
			width:100%;
			opacity:1;
		}

		object{
			width:100%;
			left:0;
			height:100%;
			
		}

		.dataTable{
			

		}

		.browse{		
			height:100%;	
			width:calc(100% - 100px);
			
			position:fixed;
			margin-left:50px;
			z-index:99;
			
		}

/*		table.dataTable {
			width:34%;
		}

		table{
			max-width:34%;
		}
*/

/*
	
*/
		
		.tile{
			
			width:95%;
			height:100%;
			margin:0px 0px 2.5% 45px;
			position:relative;
			z-index:9999;
		}

		.tile div{
			float:left;
			position:relative;
			text-align:center;
			width:200px;
			height:300px;
			padding:25px;

			border-bottom:1px solid #EFEFEF;
		}

		.tileSquare img{
			text-align:center;
			width:80px;
			height:133px;
		}


		

		.media{
			margin: 0 auto;
		}

		

		footer{
			width:99%;
			position:absolute;
			bottom:1;
			text-align:right;
			color:blue;

		}

		footer span{
			float:right;
		}

		.row {
		  display: flex;
		  flex-wrap: wrap;
		  padding: 0 4px;
		}

		/* Create four equal columns that sits next to each other */
		.column {
		  flex: 25%;
		  max-width: 25%;
		  padding: 0 4px;
		}

		.column div {
		  margin-top: 8px;
		  vertical-align: middle;
		  width: 100%;

		  border:1px solid black;
		}

		/* Responsive layout - makes a two column-layout instead of four columns */
		@media screen and (max-width: 800px) {
		  .column {
		    flex: 50%;
		    max-width: 50%;
		  }

		  .h1{
		  	font-size:36px;
		  }
		}

		/* Responsive layout - makes the two columns stack on top of each other instead of next to each other */
		@media screen and (max-width: 600px) {
		  .column {
		    flex: 100%;
		    max-width: 100%;
		  }



		.toggleCtrls {
			position:fixed;
			bottom:2px;
			width:100%;
			color:green;
			margin:0 auto;
			text-align:center;
			z-index:9999;
		}

		.toggleCtrls span{
			text-align:center;
			margin:0 auto;
			width:100px;
		}

	</style>




 









</body></html>
